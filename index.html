<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pelacakan Barang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        .card-enter {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .highlight-row {
            transition: background-color 0.2s;
        }
        .highlight-row:hover {
            background-color: #f0fdf4;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Sistem Pelacakan Barang</h1>
                    <p class="text-gray-600">Kelola stok barang masuk dan keluar harian</p>
                </div>
                <div class="flex items-center gap-2">
                    <div class="text-sm bg-green-100 text-green-800 px-3 py-1 rounded-full font-medium">
                        <i class="fas fa-calendar-day mr-1"></i>
                        <span id="current-date"></span>
                    </div>
                    <div class="flex gap-4">
                        <div class="bg-white rounded-lg shadow-md p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-500">Total Stok Tersedia</p>
                                    <h3 class="text-2xl font-bold text-gray-800" id="total-stock">0</h3>
                                </div>
                                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                                    <i class="fas fa-boxes text-xl"></i>
                                </div>
                            </div>
                        </div>
                        <button onclick="window.showAddStockModal()" class="bg-white rounded-lg shadow-md p-4 hover:bg-gray-50 flex items-center gap-2 text-green-600">
                            <i class="fas fa-plus-circle text-xl"></i>
                            <span class="font-medium">Tambah Stok Barang</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Input Form Section -->
            <div class="lg:col-span-1 bg-white rounded-lg shadow-md p-6 h-fit">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-plus-circle mr-2 text-green-600"></i>
                    Tambah Barang
                </h2>
                <form id="item-form" class="space-y-4">
                    <div>
                        <label for="item-name" class="block text-sm font-medium text-gray-700 mb-1">Nama Barang</label>
                        <select id="item-name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="" disabled selected>Pilih Barang</option>
                            <option value="kabel dw 1c">kabel dw 1c</option>
                            <option value="adaptor">adaptor</option>
                            <option value="modem antena">modem antena</option>
                            <option value="modem non antena">modem non antena</option>
                            <option value="modem penarikan">modem penarikan</option>
                            <option value="patcore">patcore</option>
                            <option value="protek kecil">protek kecil</option>
                            <option value="protek gede">protek gede</option>
                            <option value="tali tis">tali tis</option>
                            <option value="clem kabel">clem kabel</option>
                            <option value="clousure 12c">clousure 12c</option>
                            <option value="clousure 24c">clousure 24c</option>
                            <option value="spliter 1/16">spliter 1/16</option>
                            <option value="spliter 1/8">spliter 1/8</option>
                            <option value="roset">roset</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="item-category" class="block text-sm font-medium text-gray-700 mb-1">Kategori</label>
                        <select id="item-category" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option value="Elektronik">Elektronik</option>
                            <option value="Perkakas">Perkakas</option>
                            <option value="Peralatan Kantor">Peralatan Kantor</option>
                            <option value="Material">Material</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="item-quantity" class="block text-sm font-medium text-gray-700 mb-1">Jumlah</label>
                        <input type="number" id="item-quantity" min="1" value="1" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div>
                        <label for="item-person" class="block text-sm font-medium text-gray-700 mb-1">Orang yang Mengambil</label>
                        <div class="flex">
                            <input type="text" id="item-person" required
                                class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Nama">
                            <button type="button" id="person-list-btn" class="px-3 bg-gray-200 text-gray-700 rounded-r-md hover:bg-gray-300">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <div class="flex space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="item-status" value="Masuk" checked
                                    class="form-radio h-4 w-4 text-green-600 focus:ring-green-500">
                                <span class="ml-2 text-gray-700">Barang Masuk</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="item-status" value="Keluar"
                                    class="form-radio h-4 w-4 text-red-600 focus:ring-red-500">
                                <span class="ml-2 text-gray-700">Barang Keluar</span>
                            </label>
                        </div>
                    </div>
                    
                    <input type="hidden" id="item-id" value="">
                    
                    <div class="pt-2">
                        <button type="submit" id="submit-btn"
                            class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-md font-medium transition duration-200">
                            <i class="fas fa-save mr-2"></i>Simpan Data
                        </button>
                        <button type="button" id="cancel-edit" style="display: none;"
                            class="w-full mt-2 bg-gray-200 hover:bg-gray-300 text-gray-800 py-2 px-4 rounded-md font-medium transition duration-200">
                            <i class="fas fa-times mr-2"></i>Batal Edit
                        </button>
                    </div>
                </form>
            </div>

            <!-- Data Table Section -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Total Barang Masuk</p>
                                <h3 class="text-2xl font-bold text-gray-800" id="total-in">0</h3>
                            </div>
                            <div class="p-3 rounded-full bg-green-100 text-green-600">
                                <i class="fas fa-arrow-down text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Total Barang Keluar</p>
                                <h3 class="text-2xl font-bold text-gray-800" id="total-out">0</h3>
                            </div>
                            <div class="p-3 rounded-full bg-red-100 text-red-600">
                                <i class="fas fa-arrow-up text-xl"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Total Orang</p>
                                <h3 class="text-2xl font-bold text-gray-800" id="total-people">0</h3>
                            </div>
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                                <i class="fas fa-users text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                        <h2 class="text-xl font-semibold text-gray-800">
                            <i class="fas fa-exchange-alt mr-2 text-blue-600"></i>
                            Transaksi Terkini
                        </h2>
                        <button id="refresh-btn" class="text-sm text-blue-600 hover:text-blue-800">
                            <i class="fas fa-sync-alt mr-1"></i>Refresh
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Barang</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Orang</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="items-list" class="bg-white divide-y divide-gray-200">
                                <!-- Items will be added here dynamically -->
                                <tr>
                                    <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">Tidak ada data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- People Summary -->
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="border-b border-gray-200 px-6 py-4">
                        <h2 class="text-xl font-semibold text-gray-800">
                            <i class="fas fa-user-friends mr-2 text-purple-600"></i>
                            Ringkasan Per Orang
                        </h2>
                        <p class="text-sm text-gray-500 mt-1">Daftar orang yang mengambil barang beserta jumlahnya</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Detail Barang yang Diambil</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Item</th>
                                </tr>
                            </thead>
                            <tbody id="people-list" class="bg-white divide-y divide-gray-200">
                                <!-- People summary will be added here dynamically -->
                                <tr>
                                    <td colspan="3" class="px-6 py-4 text-center text-sm text-gray-500">Tidak ada data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Stock Modal -->
    <div id="add-stock-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-y-auto">
            <div class="border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-800">Tambah Stok Barang</h3>
                <button onclick="document.getElementById('add-stock-modal').classList.add('hidden')" 
                    class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nama Barang</label>
                    <select id="add-stock-item" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="" disabled selected>Pilih Barang</option>
                        <option value="kabel dw 1c">kabel dw 1c</option>
                        <option value="adaptor">adaptor</option>
                        <option value="modem antena">modem antena</option>
                        <option value="modem non antena">modem non antena</option>
                        <option value="modem penarikan">modem penarikan</option>
                        <option value="patcore">patcore</option>
                        <option value="protek kecil">protek kecil</option>
                        <option value="protek gede">protek gede</option>
                        <option value="tali tis">tali tis</option>
                        <option value="clem kabel">clem kabel</option>
                        <option value="clousure 12c">clousure 12c</option>
                        <option value="clousure 24c">clousure 24c</option>
                        <option value="spliter 1/16">spliter 1/16</option>
                        <option value="spliter 1/8">spliter 1/8</option>
                        <option value="roset">roset</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Jumlah</label>
                    <input type="number" id="add-stock-amount" min="1" value="1" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                <div class="flex gap-2">
                    <button onclick="window.confirmAddStock()" 
                        class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
                        <i class="fas fa-plus-circle mr-2"></i> Tambah Stok
                    </button>
                    <button onclick="window.confirmRemoveStock()" 
                        class="flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                        <i class="fas fa-minus-circle mr-2"></i> Kurangi Stok
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Person List Modal -->
    <div id="person-modal" class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full max-h-[80vh] overflow-y-auto">
            <div class="border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-800">Daftar Nama</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div class="flex">
                    <input type="text" id="new-person" placeholder="Tambah nama baru" 
                        class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="add-person" class="px-4 bg-blue-600 text-white rounded-r-md hover:bg-blue-700">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <ul id="person-list" class="divide-y divide-gray-200 max-h-60 overflow-y-auto">
                    <!-- Person list will be added here dynamically -->
                    <li class="py-2 text-gray-500 text-center">Belum ada nama</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Set current date
        const currentDate = new Date().toLocaleDateString('id-ID', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        document.getElementById('current-date').textContent = currentDate;

        // DOM Elements
        const itemForm = document.getElementById('item-form');
        const itemName = document.getElementById('item-name');
        const itemCategory = document.getElementById('item-category');
        const itemQuantity = document.getElementById('item-quantity');
        const itemPerson = document.getElementById('item-person');
        const itemStatus = document.getElementsByName('item-status');
        const itemId = document.getElementById('item-id');
        const submitBtn = document.getElementById('submit-btn');
        const cancelEditBtn = document.getElementById('cancel-edit');
        const itemsList = document.getElementById('items-list');
        const peopleList = document.getElementById('people-list');
        const personModal = document.getElementById('person-modal');
        const personListBtn = document.getElementById('person-list-btn');
        const closeModalBtn = document.getElementById('close-modal');
        const personList = document.getElementById('person-list');
        const newPerson = document.getElementById('new-person');
        const addPersonBtn = document.getElementById('add-person');
        const refreshBtn = document.getElementById('refresh-btn');
        const totalInElement = document.getElementById('total-in');
        const totalOutElement = document.getElementById('total-out');
        const totalPeopleElement = document.getElementById('total-people');

        // Data
        let items = JSON.parse(localStorage.getItem('inventory_items')) || [];
        let people = JSON.parse(localStorage.getItem('inventory_people')) || [];
        // Initialize available stock with default values
        const defaultStock = {
            "kabel dw 1c": 0,
            "adaptor": 0,
            "modem antena": 0,
            "modem non antena": 0,
            "modem penarikan": 0,
            "patcore": 0,
            "protek kecil": 0,
            "protek gede": 0,
            "tali tis": 0,
            "clem kabel": 0,
            "clousure 12c": 0,
            "clousure 24c": 0,
            "spliter 1/16": 0,
            "spliter 1/8": 0,
            "roset": 0
        };
        let availableStock = JSON.parse(localStorage.getItem('available_stock')) || defaultStock;

        // Helper function to show alerts
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `fixed top-4 right-4 p-4 rounded-md shadow-md text-white ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            }`;
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 3000);
        }

        // Show add stock modal
        function showAddStockModal() {
            document.getElementById('add-stock-modal').classList.remove('hidden');
        }

        // Confirm removing stock from modal
        function confirmRemoveStock() {
            const itemSelect = document.getElementById('add-stock-item');
            const amountInput = document.getElementById('add-stock-amount');
            const itemName = itemSelect.value;
            const amount = parseInt(amountInput.value);
            
            if (!itemName) {
                alert('Silakan pilih barang');
                return;
            }
            
            if (isNaN(amount) || amount <= 0) {
                alert('Masukkan jumlah yang valid');
                return;
            }

            const currentStock = availableStock[itemName] || 0;
            if (amount > currentStock) {
                alert(`Jumlah melebihi stok tersedia! Stok saat ini: ${currentStock}`);
                return;
            }
            
            availableStock[itemName] = currentStock - amount;
            localStorage.setItem('available_stock', JSON.stringify(availableStock));
            
            document.getElementById('add-stock-modal').classList.add('hidden');
            renderItems();
            updateCounters();
            showAlert('success', `Berhasil mengurangi ${amount} stok dari ${itemName}`);
        }

        // Confirm adding stock from modal
        function confirmAddStock() {
            const itemSelect = document.getElementById('add-stock-item');
            const amountInput = document.getElementById('add-stock-amount');
            const itemName = itemSelect.value;
            const amount = parseInt(amountInput.value);
            
            if (!itemName) {
                alert('Silakan pilih barang');
                return;
            }
            
            if (isNaN(amount) || amount <= 0) {
                alert('Masukkan jumlah yang valid');
                return;
            }
            
            availableStock[itemName] = (availableStock[itemName] || 0) + amount;
            localStorage.setItem('available_stock', JSON.stringify(availableStock));
            
            document.getElementById('add-stock-modal').classList.add('hidden');
            renderItems();
            updateCounters();
            showAlert('success', `Berhasil menambahkan ${amount} stok untuk ${itemName}`);
        }

        // Initialize the app
        function initApp() {
            renderItems();
            renderPeopleSummary();
            updateCounters();
        }

        // Render items to the table
        function renderItems() {
            if (items.length === 0) {
                itemsList.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-4 text-center text-sm text-gray-500">Tidak ada data</td>
                    </tr>
                `;
                return;
            }

            itemsList.innerHTML = items.map(item => `
                <tr class="highlight-row" data-id="${item.id}">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="font-medium text-gray-900 flex items-center gap-2">
                            ${item.name}
                            <div class="text-sm px-2 py-1 rounded-full ${availableStock[item.name] > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} border ${availableStock[item.name] > 0 ? 'border-green-200' : 'border-red-200'}">
                                <span class="font-medium">${availableStock[item.name] || 0}</span>
                                <span class="text-xs ml-1">stok</span>
                            </div>
                            <div class="flex gap-1 ml-2">
                                <button onclick="window.editStock('${item.id}')" class="text-blue-600 hover:text-blue-800" title="Edit Stok">
                                    <i class="fas fa-edit text-sm"></i>
                                </button>
                                <button onclick="window.addStock('${item.id}')" class="text-green-600 hover:text-green-800" title="Tambah Stok">
                                    <i class="fas fa-plus-circle text-sm"></i>
                                </button>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.quantity}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${item.status === 'Masuk' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${item.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.person}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="window.editItem('${item.id}')" class="text-blue-600 hover:text-blue-900 mr-3">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="window.deleteItem('${item.id}')" class="text-red-600 hover:text-red-900">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Render people summary
        function renderPeopleSummary() {
            // Group items by person
            const personItems = {};
            items.forEach(item => {
                if (item.status === 'Keluar') {
                    if (!personItems[item.person]) {
                        personItems[item.person] = {
                            items: [],
                            total: 0
                        };
                    }
                    personItems[item.person].items.push(item.name);
                    personItems[item.person].total += item.quantity;
                }
            });

            if (Object.keys(personItems).length === 0) {
                peopleList.innerHTML = `
                    <tr>
                        <td colspan="3" class="px-6 py-4 text-center text-sm text-gray-500">Tidak ada data</td>
                    </tr>
                `;
                return;
            }

            // Group items with quantities
            const detailedPersonItems = {};
            items.forEach(item => {
                if (item.status === 'Keluar') {
                    if (!detailedPersonItems[item.person]) {
                        detailedPersonItems[item.person] = {
                            itemDetails: {},
                            totalItems: 0
                        };
                    }
                    if (!detailedPersonItems[item.person].itemDetails[item.name]) {
                        detailedPersonItems[item.person].itemDetails[item.name] = 0;
                    }
                    detailedPersonItems[item.person].itemDetails[item.name] += item.quantity;
                    detailedPersonItems[item.person].totalItems++;
                }
            });

            peopleList.innerHTML = Object.entries(detailedPersonItems).map(([person, data]) => {
                const itemList = Object.entries(data.itemDetails).map(([itemName, quantity]) => 
                    `${itemName} ${quantity}`
                ).join(', ');
                
                return `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${person}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${itemList}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.totalItems}</td>
                </tr>
                `;
            }).join('');
        }

        // Render person list in modal
        function renderPersonList() {
            if (people.length === 0) {
                personList.innerHTML = `
                    <li class="py-2 text-gray-500 text-center">Belum ada nama</li>
                `;
                return;
            }

            personList.innerHTML = people.map(person => `
                <li class="py-2 flex justify-between items-center">
                    <span>${person}</span>
                    <button onclick="window.selectPerson('${person}')" class="text-sm text-blue-600 hover:text-blue-800">
                        <i class="fas fa-check"></i> Pilih
                    </button>
                </li>
            `).join('');
        }

        // Update counters
        function updateCounters() {
            const totalIn = items.filter(item => item.status === 'Masuk').length;
            const totalOut = items.filter(item => item.status === 'Keluar').length;
            
            const personItems = {};
            items.forEach(item => {
                if (item.status === 'Keluar' && !personItems[item.person]) {
                    personItems[item.person] = true;
                }
            });
            
            totalInElement.textContent = totalIn;
            totalOutElement.textContent = totalOut;
            totalPeopleElement.textContent = Object.keys(personItems).length;
            document.getElementById('total-stock').textContent = Object.values(availableStock).reduce((a,b) => a + b, 0) || 0;
        }

        // Generate ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Add or update item
        function handleSubmit(e) {
            e.preventDefault();
            
            const name = typeof itemName.value === 'string' ? itemName.value.trim() : itemName.value;
            const category = itemCategory.value;
            const quantity = parseInt(itemQuantity.value);
            const person = itemPerson.value.trim();
            const status = document.querySelector('input[name="item-status"]:checked').value;
            
            if (name === '' || person === '' || isNaN(quantity) || quantity <= 0) {
                return;
            }
            
            if (itemId.value === '') {
                // Update available stock
                if (status === 'Masuk') {
                    // Add to stock
                    availableStock[name] = (availableStock[name] || 0) + quantity;
                    showAlert('success', `Stok ${name} ditambahkan ${quantity}, total sekarang: ${availableStock[name]}`);
                } else if (status === 'Keluar') {
                    // Check and subtract from stock
                    const currentStock = availableStock[name] || 0;
                    if (currentStock < quantity) {
                        showAlert('error', `Stok ${name} tidak mencukupi! Stok tersedia: ${currentStock}`);
                        return false;
                    }
                    availableStock[name] = currentStock - quantity;
                    showAlert('success', `Stok ${name} berkurang ${quantity}, sisa: ${availableStock[name]}`);
                }
                
                // Add new item
                const newItem = {
                    id: generateId(),
                    name,
                    category,
                    quantity,
                    person,
                    status,
                    date: new Date().toISOString()
                };
                items.push(newItem);
                
                // Save stock to localStorage
                localStorage.setItem('available_stock', JSON.stringify(availableStock));
            } else {
                // Update existing item - More complex stock adjustment needed here
                const index = items.findIndex(item => item.id === itemId.value);
                if (index !== -1) {
                    const oldItem = items[index];
                    if (oldItem.status !== status || oldItem.quantity !== quantity) {
                        // First reverse old stock change
                        if (oldItem.status === 'Masuk') {
                            availableStock[oldItem.name] -= oldItem.quantity;
                        } else {
                            availableStock[oldItem.name] += oldItem.quantity;
                        }
                        
                        // Apply new stock change
                        if (status === 'Masuk') {
                            availableStock[name] += quantity;
                        } else {
                            if ((availableStock[name] || 0) < quantity) {
                                alert(`Stok ${name} tidak mencukupi! Stok tersedia: ${availableStock[name] || 0}`);
                                return;
                            }
                            availableStock[name] -= quantity;
                        }
                    }
                    
                    items[index] = {
                        id: itemId.value,
                        name,
                        category,
                        quantity,
                        person,
                        status,
                        date: items[index].date
                    };
                }
            }
            
            // Save to localStorage
            localStorage.setItem('inventory_items', JSON.stringify(items));
            localStorage.setItem('available_stock', JSON.stringify(availableStock));
            
            // Reset form
            itemForm.reset();
            itemId.value = '';
            submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Simpan Data';
            cancelEditBtn.style.display = 'none';
            
            // Update UI
            renderItems();
            renderPeopleSummary();
            updateCounters();
        }

        // Edit item
        function editItem(id) {
            const item = items.find(item => item.id === id);
            if (!item) return;
            
            itemName.querySelector(`option[value="${item.name}"]`).selected = true;
            itemCategory.value = item.category;
            itemQuantity.value = item.quantity;
            itemPerson.value = item.person;
            document.querySelector(`input[name="item-status"][value="${item.status}"]`).checked = true;
            itemId.value = item.id;
            
            submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Update Data';
            cancelEditBtn.style.display = 'block';
            
            // Scroll to form
            itemForm.scrollIntoView({ behavior: 'smooth' });
        }

        // Delete item
        function deleteItem(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) return;
            
            items = items.filter(item => item.id !== id);
            localStorage.setItem('inventory_items', JSON.stringify(items));
            
            renderItems();
            renderPeopleSummary();
            updateCounters();
        }

        // Cancel edit
        function cancelEdit() {
            itemForm.reset();
            itemId.value = '';
            submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Simpan Data';
            cancelEditBtn.style.display = 'none';
        }

        // Add new person
        function addNewPerson() {
            const name = newPerson.value.trim();
            if (name === '') return;
            
            if (!people.includes(name)) {
                people.push(name);
                localStorage.setItem('inventory_people', JSON.stringify(people));
                renderPersonList();
                newPerson.value = '';
            } else {
                alert('Nama sudah ada dalam daftar!');
            }
        }

        // Select person from list
        function selectPerson(name) {
            itemPerson.value = name;
            personModal.classList.add('hidden');
        }

        // Event Listeners
        itemForm.addEventListener('submit', handleSubmit);
        cancelEditBtn.addEventListener('click', cancelEdit);
        document.getElementById('person-list-btn').addEventListener('click', () => {
            renderPersonList();
            personModal.classList.remove('hidden');
        });
        document.getElementById('close-modal').addEventListener('click', () => personModal.classList.add('hidden'));
        document.getElementById('add-person').addEventListener('click', addNewPerson);
        document.getElementById('refresh-btn').addEventListener('click', initApp);

        // Allow pressing Enter to add new person
        newPerson.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addNewPerson();
            }
        });

        // Initialize the app
        initApp();

        // Edit stock quantity directly
        function editStock(id) {
            const item = items.find(item => item.id === id);
            if (!item) return;
            
            const stockModal = document.createElement('div');
            stockModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            stockModal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96">
                    <h3 class="text-lg font-medium mb-4">Edit Stok ${item.name}</h3>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Jumlah Stok</label>
                        <input type="number" id="stock-input" value="${availableStock[item.name] || 0}" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md">
                    </div>
                    <div class="flex justify-end gap-2">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                            class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md">
                            Batal
                        </button>
                        <button onclick="updateStock('${item.id}')" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-md">
                            Simpan
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(stockModal);
            
            window.updateStock = function(id) {
                const item = items.find(item => item.id === id);
                const input = document.getElementById('stock-input');
                const newStock = parseInt(input.value);
                
                if (!isNaN(newStock)) {
                    availableStock[item.name] = newStock;
                    localStorage.setItem('available_stock', JSON.stringify(availableStock));
                    stockModal.remove();
                    renderItems();
                    updateCounters();
                    showAlert('success', `Stok ${item.name} diperbarui menjadi ${newStock}`);
                }
            }
        }

        // Function to add stock
        function addStock(id) {
            const item = items.find(item => item.id === id);
            if (!item) return;
            
            const addAmount = prompt(`Masukkan jumlah stok ${item.name} yang akan ditambahkan:`);
            if (addAmount && !isNaN(addAmount)) {
                const currentStock = availableStock[item.name] || 0;
                availableStock[item.name] = currentStock + parseInt(addAmount);
                localStorage.setItem('available_stock', JSON.stringify(availableStock));
                renderItems();
                updateCounters();
                showAlert('success', `Ditambahkan ${addAmount} stok ${item.name}, total sekarang: ${availableStock[item.name]}`);
            }
        }

        // Expose functions to global scope
        window.editItem = editItem;
        window.showAddStockModal = showAddStockModal;
        window.confirmAddStock = confirmAddStock;
        window.confirmRemoveStock = confirmRemoveStock;
        window.addStock = addStock;
        window.editStock = editStock;
        window.deleteItem = deleteItem; 
        window.selectPerson = selectPerson;
    </script>
</body>
</html>

